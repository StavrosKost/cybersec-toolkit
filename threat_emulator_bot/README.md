# Threat Emulation Bot Toolkit

This toolkit provides a simple framework for simulating Tactics, Techniques, and Procedures (TTPs) based on predefined commands or the MITRE ATT&CK framework. It includes a core execution engine, a web-based dashboard for control, and a log analyzer.

## Files and Directories

*   `threat_bot.py`: The main Python script that executes TTPs. It can run in two modes:
    *   **Standard Mode:** Reads TTPs (including commands) directly from a specified JSON file (like `ttp_library.json`).
    *   **MITRE Mode:** Reads techniques from `attack-dataset.json`, randomly selects a few, looks up corresponding executable commands in `ttp_library.json` using the MITRE ID, and executes them.
*   `dashboard.py`: A Streamlit web application providing a UI to control `threat_bot.py`. Allows selecting the TTP source (`ttp_library.json` or `attack-dataset.json`), toggling dry-run mode, and initiating execution.
*   `log_analyzer.py`: A script to parse log files generated by `threat_bot.py` and provide a daily summary of activities.
*   `ttp_library.json`: **(User Configurable)** A JSON file containing a list of TTPs with specific commands to execute. This file maps technique IDs (ideally MITRE IDs) to actual, runnable commands for different platforms.
*   `attack-dataset.json`: A dataset containing MITRE ATT&CK framework data (techniques, tactics, etc.) in STIX format. Used by the MITRE mode in `threat_bot.py` for technique selection and information display.
*   `utils.py`: (Assumed based on dashboard import) Contains utility functions, likely including `load_attack_mapping`.
*   `requirements.txt`: Lists the necessary Python libraries (`streamlit`).
*   `logs/`: The directory where execution logs (`threat_bot_YYYYMMDD_HHMMSS.log`) are stored.
*   `execution_log.json`: Stores a structured log of recently executed TTPs, primarily used by the dashboard.

## Setup

1.  Ensure you have Python 3 installed.
2.  Clone or download the project files.
3.  Navigate to the project directory in your terminal.
4.  Install the required libraries:
    ```bash
    pip install -r requirements.txt
    ```

## Usage

### 1. Running the Dashboard (Recommended)

The easiest way to use the toolkit is via the Streamlit dashboard.

1.  Open your terminal in the project directory.
2.  Run the command:
    ```bash
    streamlit run dashboard.py
    ```
3.  Open the URL provided by Streamlit (usually `http://localhost:8501`) in your web browser.
4.  Use the sidebar in the dashboard to:
    *   Select the **TTP Set** (`ttp_library.json` for direct command execution, `attack-dataset.json` for MITRE mode).
    *   Toggle **Dry Run Mode** (if checked, commands will be printed but not executed).
    *   Click **▶️ Run threat_bot.py** to start the emulation.

### 2. Running the Threat Bot Directly

You can also run the core bot script directly from the terminal.

```bash
python threat_bot.py [OPTIONS]
```

Available options:
*   `--ttp-set <filename.json>`: Specify the input JSON file. Defaults to `ttp_library.json`. Use `attack-dataset.json` for MITRE mode.
*   `--iterations <number>`: Number of random TTPs to select and run. Defaults to 3 (ignored in MITRE mode, which uses 5).
*   `--dry-run`: If present, only print commands, do not execute.

**Examples:**
*   `python threat_bot.py --ttp-set ttp_library.json --iterations 5` (Run 5 random TTPs from the library)
*   `python threat_bot.py --ttp-set attack-dataset.json --dry-run` (Run 5 random MITRE techniques in dry-run mode, executing commands found in `ttp_library.json`)

### 3. Analyzing Logs

To get a summary of the day's activities:

*   **Analyze today's logs:**
    ```bash
    python log_analyzer.py
    ```
*   **Analyze logs for a specific date:**
    ```bash
    python log_analyzer.py --date YYYY-MM-DD
    ```
    (e.g., `python log_analyzer.py --date 2025-04-16`)

## Configuration: `ttp_library.json`

This file is crucial for defining *what* commands actually run. It's a JSON list `[...]` where each element is an object `{...}` representing a single executable TTP.

**Required fields for each TTP object:**
*   `id` (string): The Technique ID. **Crucially, for MITRE mode to work, this ID must exactly match a MITRE ATT&CK Technique ID** (e.g., `"T1059.001"`, `"T1063"`).
*   `name` (string): A descriptive name for the TTP.
*   `description` (string): A brief explanation of what the command does.
*   `platform` (string): The operating system the command is intended for (`"windows"`, `"linux"`, `"macos"`, or `"all"`). This is used for compatibility checks.
*   `command` (string): The actual command-line string to execute.

**Optional fields:**
*   `tactic` (string): The associated MITRE Tactic (e.g., `"discovery"`, `"execution"`).
*   `url` (string): A URL for more information (e.g., the MITRE technique page).

**Example Entry:**
```json
{
  "id": "T1057",
  "name": "Process Discovery (Tasklist)",
  "description": "Lists running processes using tasklist.",
  "platform": "windows",
  "command": "tasklist /FO CSV",
  "tactic": "discovery"
}
```

**Important:** You need to manually add entries to `ttp_library.json` for any MITRE techniques you want the bot to be able to execute when running in `attack-dataset.json` mode. Ensure JSON syntax (commas between objects, correct quotes, escaped backslashes in commands if needed) is valid.

## Logging

*   Detailed execution logs are created in the `logs/` directory, named `threat_bot_YYYYMMDD_HHMMSS.log`.
*   Each log file contains both plain text status messages and JSON objects detailing individual TTP execution attempts.
*   The `execution_log.json` file stores a rolling log of recent TTP executions in JSON format, primarily for display in the dashboard.
